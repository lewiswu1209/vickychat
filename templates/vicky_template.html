<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Source code generated using layoutit.com">
    <meta name="author" content="LayoutIt!">
    <title>聊天机器人</title>
    <link href="{{ url_for( 'static', filename='css/bootstrap.min.css' ) }}" rel="stylesheet">
    <style>
        body {
                background:-moz-linear-gradient(-45deg,#183850 0,#183850 25%,#192C46 50%,#22254C 75%,#22254C 100%);
                background:-webkit-linear-gradient(-45deg,#183850 0,#183850 25%,#192C46 50%,#22254C 75%,#22254C 100%);
                background-repeat:no-repeat;
                background-attachment:fixed
        }
        .output-box {
                font:24px "Noto Sans",sans-serif;
                text-align: center;
                background:0;
                color:#0AD5C1;
                border:0;
                border-bottom:1px solid rgba(25,147,147,0.2);
                outline:0
        }
        .input-box {
                font:24px "Noto Sans",sans-serif;
                text-align: center;
                background:0;
                color:#0AD5C1;
                border:0;
                border-bottom:1px solid rgba(25,147,147,0.2);
                outline:0
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row  row-eq-height">
            <model-viewer class="col-md-12" style="position:fixed; height:100%;bottom: 65px;" src="{{model_path}}" camera-controls />
        </div>
        <div class="row fixed-bottom">
            <div class="col-md-12">
                <input class="col-md-12 output-box" type="text" disabled>
            </div>
            <div class="col-md-12">
                <input class="col-md-12 input-box" type="text" autocomplete="off" autofocus placeholder="有空和我聊天么~">
            </div>
        </div>
    </div>
    <script src="{{ url_for( 'static', filename='js/jquery.min.js' ) }}"></script>
    <script src="{{ url_for( 'static', filename='js/bootstrap.min.js' ) }}"></script>
    <script src="https://unpkg.com/@google/model-viewer@1.12.0/dist/model-viewer.min.js" type="module"></script>
    <script>
        var input_box = document.querySelector(".input-box");

        input_box.onkeydown=function(event){
            var e = event || window.event || arguments.callee.caller.arguments[0];
            if (e && e.keyCode == 13 ) {
                send_data();
            }
        }

        function send_data() {
            var input_box = document.querySelector(".input-box");
            var output_box = document.querySelector(".output-box");

            input_box.disabled = true;
            var text = input_box.value;

            input_box.value = "";
            output_box.value= "对方正在输入……";
            $.ajax({ 
                url: "/vicky/api_v1/chat?text="+text, 
                dataType: 'json',
                success: function(data){
                    output_box.value = data.message

                    input_box.disabled = false;
                },
                timeout: 600000,
                error: function(jqXHR, status, errorThrown){
                    var output_box = document.querySelector(".output-box");
                    output_box.value = "网络超时10分钟，请重试"

                    input_box.disabled = false;
                } 
            });
        }
    </script>
</body>
</html>
